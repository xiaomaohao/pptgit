<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Preparation</title>
    <meta charset="utf-8" />
    <meta name="author" content="Yangyong Ye" />
    <script src="libs/header-attrs-2.5.3/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/chocolate.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/chocolate-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="my_css.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data Preparation
## second class
### Yangyong Ye
### SOE, RUE
### 2020/11/16 (updated: 2020-11-23)

---






# Rstudio Intro
  
- Panel: source/console/environment/files/plots/packages/help/viewer

- Exercise: 

  1. create a script, save, close and open it

  2. create a project, put a data in it.

  3. install package, like "tidyverse", load it.

  4. options/appearance, setup theme, it is important to change **mirror source**.

---
# Data I/O

+ readr: reads .csv data.

+ haven: reads SPSS, Stata, and SAS files.

+ readxl: reads excel files (both .xls and .xlsx).

+ read_json: reads json data.

+ read_ogr: write_rds() and read_rds() are uniform wrappers around the base functions readRDS() and saveRDS().

+ **rio**: .red[import, export, convert]

---

# Commonly Used Functions

- ?
- str
- summary
- %in%
- head, tail
- with
- round, n, sum, mean, sd
- length, dim, ncol, nrow, names, colnames, rownames
- rep, seq, rev, sample, ifelse, list

---

# [tidyverse](https://www.tidyverse.org) packages:

- ggplot2, for data visualisation.

- dplyr, for data manipulation.

- tidyr, for data tidying.

- readr, for data import.

- purrr, for functional programming.

- tibble, for tibbles, a modern re-imagining of data frames.

- stringr, for strings.

- forcats, for factors.

---
# Colummn Manipulation Overview

  - select
  
  - rename
  
  - relocate
  
  - mutate
  
  - recode
  
---

# Overview of selection features [tidyselect](https://tidyselect.r-lib.org/reference/language.html)

Tidyverse selections implement a dialect of R where operators make it easy to select variables:

- : for selecting a range of consecutive variables.

- ! for taking the complement of a set of variables.

- &amp; and | for selecting the intersection or the union of two sets of variables.

- c() for combining selections.

In addition, you can use selection helpers. Some helpers select specific columns:

- everything(): Matches all variables.

- last_col(): Select last variable, possibly with an offset.

---

# Overview of selection features [tidyselect](https://tidyselect.r-lib.org/reference/language.html)
- These helpers select variables by matching patterns in their names:

  - starts_with(): Starts with a prefix.

  - ends_with(): Ends with a suffix.

  - contains(): Contains a literal string.

  - matches(): Matches a regular expression.

  - num_range(): Matches a numerical range like x01, x02, x03.

- These helpers select variables from a character vector:

  - all_of(): Matches variable names in a character vector. All names must be present, otherwise an out-of-bounds error is thrown.

  - any_of(): Same as all_of(), except that no error is thrown for names that don't exist.

- This helper selects variables with a function:

   - where(): Applies a function to all variables and selects those for which the function returns TRUE.


---

# Row manipulation

  - filter
  
  - arrange
  
  - slice: slice_head, slice_tail, slice_sample, slice_min, slice_max


---
# filter: conditions

- R provides the standard suite: &gt;, &gt;=, &lt;, &lt;=, != (not equal), and == (equal).

- Boolean operators yourself: &amp; is ??and??, | is ??or??, and ! is ??not??.,


---
# R basic:

[Data type](https://evamaerey.github.io/data_manipulation/about)

---

# Multiple column or row manipulation

  - across
  
  - group_by &amp; summarize
  
  - count
  
  - distinct
  
  - rowwise &amp; c_across


???

this is not right
  
---

# Separate &amp; unite

  - extract
  
  - separate
  
  - unite

---

# TWO TABLE VERBS

- Mutating Joins 
  — inner_join(), left_join(), right_join(), full_join()

- Filtering Joins 
  — semi_join(), anti_join()

- Set Operations — union(), intersect(), setdiff()
  - intersect(x, y): return only observations in both x and y
  
  - union(x, y): return unique observations in x and y
  
  - setdiff(x, y): return observations in x, but not in y

---

count: false
 

.panel1-join-auto[

```r
*library(gapminder)
```
]
 
.panel2-join-auto[

]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
*library(tidyverse)
```
]
 
.panel2-join-auto[

]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
*gapminder
```
]
 
.panel2-join-auto[

```
# A tibble: 1,704 x 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
* select(country, lifeExp, year)
```
]
 
.panel2-join-auto[

```
# A tibble: 1,704 x 3
   country     lifeExp  year
   &lt;fct&gt;         &lt;dbl&gt; &lt;int&gt;
 1 Afghanistan    28.8  1952
 2 Afghanistan    30.3  1957
 3 Afghanistan    32.0  1962
 4 Afghanistan    34.0  1967
 5 Afghanistan    36.1  1972
 6 Afghanistan    38.4  1977
 7 Afghanistan    39.9  1982
 8 Afghanistan    40.8  1987
 9 Afghanistan    41.7  1992
10 Afghanistan    41.8  1997
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
  select(country, lifeExp, year) -&gt;
* country_life
```
]
 
.panel2-join-auto[

]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
  select(country, lifeExp, year) -&gt;
  country_life
*gapminder
```
]
 
.panel2-join-auto[

```
# A tibble: 1,704 x 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
  select(country, lifeExp, year) -&gt;
  country_life
gapminder %&gt;%
* select(country, pop, year)
```
]
 
.panel2-join-auto[

```
# A tibble: 1,704 x 3
   country          pop  year
   &lt;fct&gt;          &lt;int&gt; &lt;int&gt;
 1 Afghanistan  8425333  1952
 2 Afghanistan  9240934  1957
 3 Afghanistan 10267083  1962
 4 Afghanistan 11537966  1967
 5 Afghanistan 13079460  1972
 6 Afghanistan 14880372  1977
 7 Afghanistan 12881816  1982
 8 Afghanistan 13867957  1987
 9 Afghanistan 16317921  1992
10 Afghanistan 22227415  1997
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
  select(country, lifeExp, year) -&gt;
  country_life
gapminder %&gt;%
  select(country, pop, year) -&gt;
* country_pop
```
]
 
.panel2-join-auto[

]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
  select(country, lifeExp, year) -&gt;
  country_life
gapminder %&gt;%
  select(country, pop, year) -&gt;
  country_pop
*country_pop
```
]
 
.panel2-join-auto[

```
# A tibble: 1,704 x 3
   country          pop  year
   &lt;fct&gt;          &lt;int&gt; &lt;int&gt;
 1 Afghanistan  8425333  1952
 2 Afghanistan  9240934  1957
 3 Afghanistan 10267083  1962
 4 Afghanistan 11537966  1967
 5 Afghanistan 13079460  1972
 6 Afghanistan 14880372  1977
 7 Afghanistan 12881816  1982
 8 Afghanistan 13867957  1987
 9 Afghanistan 16317921  1992
10 Afghanistan 22227415  1997
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-join-auto[

```r
library(gapminder)
library(tidyverse)
gapminder %&gt;%
  select(country, lifeExp, year) -&gt;
  country_life
gapminder %&gt;%
  select(country, pop, year) -&gt;
  country_pop
country_pop %&gt;%
* full_join(country_life,
*           by = c("country","year"))
```
]
 
.panel2-join-auto[

```
# A tibble: 1,704 x 4
   country          pop  year lifeExp
   &lt;fct&gt;          &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
 1 Afghanistan  8425333  1952    28.8
 2 Afghanistan  9240934  1957    30.3
 3 Afghanistan 10267083  1962    32.0
 4 Afghanistan 11537966  1967    34.0
 5 Afghanistan 13079460  1972    36.1
 6 Afghanistan 14880372  1977    38.4
 7 Afghanistan 12881816  1982    39.9
 8 Afghanistan 13867957  1987    40.8
 9 Afghanistan 16317921  1992    41.7
10 Afghanistan 22227415  1997    41.8
# … with 1,694 more rows
```
]

&lt;style&gt;
.panel1-join-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-join-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-join-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;




---


# join
count: false
 

.panel1-lef-auto[

```r
*library(nycflights13)
```
]
 
.panel2-lef-auto[

]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
*flights
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
* select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
```
]
 
.panel2-lef-auto[

]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
  select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
*flights2
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 8
    year month   day  hour origin dest  tailnum carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
 1  2013     1     1     5 EWR    IAH   N14228  UA     
 2  2013     1     1     5 LGA    IAH   N24211  UA     
 3  2013     1     1     5 JFK    MIA   N619AA  AA     
 4  2013     1     1     5 JFK    BQN   N804JB  B6     
 5  2013     1     1     6 LGA    ATL   N668DN  DL     
 6  2013     1     1     5 EWR    ORD   N39463  UA     
 7  2013     1     1     6 EWR    FLL   N516JB  B6     
 8  2013     1     1     6 LGA    IAD   N829AS  EV     
 9  2013     1     1     6 JFK    MCO   N593JB  B6     
10  2013     1     1     6 LGA    ORD   N3ALAA  AA     
# … with 336,766 more rows
```
]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
  select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
flights2 %&gt;%
* left_join(airlines, by="carrier")
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 9
    year month   day  hour origin dest  tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
 2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
 3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
 4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
 6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
 7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
 8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
 9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
# … with 336,766 more rows
```
]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
  select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
flights2 %&gt;%
  left_join(airlines, by="carrier")

*flights2
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 9
    year month   day  hour origin dest  tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
 2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
 3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
 4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
 6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
 7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
 8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
 9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
# … with 336,766 more rows
```

```
# A tibble: 336,776 x 8
    year month   day  hour origin dest  tailnum carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
 1  2013     1     1     5 EWR    IAH   N14228  UA     
 2  2013     1     1     5 LGA    IAH   N24211  UA     
 3  2013     1     1     5 JFK    MIA   N619AA  AA     
 4  2013     1     1     5 JFK    BQN   N804JB  B6     
 5  2013     1     1     6 LGA    ATL   N668DN  DL     
 6  2013     1     1     5 EWR    ORD   N39463  UA     
 7  2013     1     1     6 EWR    FLL   N516JB  B6     
 8  2013     1     1     6 LGA    IAD   N829AS  EV     
 9  2013     1     1     6 JFK    MCO   N593JB  B6     
10  2013     1     1     6 LGA    ORD   N3ALAA  AA     
# … with 336,766 more rows
```
]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
  select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
flights2 %&gt;%
  left_join(airlines, by="carrier")

flights2 %&gt;%
* left_join(weather,
*           by=c("origin","year","month","day"))
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 9
    year month   day  hour origin dest  tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
 2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
 3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
 4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
 6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
 7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
 8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
 9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
# … with 336,766 more rows
```

```
# A tibble: 8,036,575 x 19
    year month   day hour.x origin dest  tailnum carrier hour.y  temp  dewp
   &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2013     1     1      5 EWR    IAH   N14228  UA           1  39.0  26.1
 2  2013     1     1      5 EWR    IAH   N14228  UA           2  39.0  27.0
 3  2013     1     1      5 EWR    IAH   N14228  UA           3  39.0  28.0
 4  2013     1     1      5 EWR    IAH   N14228  UA           4  39.9  28.0
 5  2013     1     1      5 EWR    IAH   N14228  UA           5  39.0  28.0
 6  2013     1     1      5 EWR    IAH   N14228  UA           6  37.9  28.0
 7  2013     1     1      5 EWR    IAH   N14228  UA           7  39.0  28.0
 8  2013     1     1      5 EWR    IAH   N14228  UA           8  39.9  28.0
 9  2013     1     1      5 EWR    IAH   N14228  UA           9  39.9  28.0
10  2013     1     1      5 EWR    IAH   N14228  UA          10  41    28.0
# … with 8,036,565 more rows, and 8 more variables: humid &lt;dbl&gt;,
#   wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
#   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
  select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
flights2 %&gt;%
  left_join(airlines, by="carrier")

flights2 %&gt;%
  left_join(weather,
            by=c("origin","year","month","day"))
*flights2
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 9
    year month   day  hour origin dest  tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
 2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
 3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
 4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
 6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
 7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
 8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
 9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
# … with 336,766 more rows
```

```
# A tibble: 8,036,575 x 19
    year month   day hour.x origin dest  tailnum carrier hour.y  temp  dewp
   &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2013     1     1      5 EWR    IAH   N14228  UA           1  39.0  26.1
 2  2013     1     1      5 EWR    IAH   N14228  UA           2  39.0  27.0
 3  2013     1     1      5 EWR    IAH   N14228  UA           3  39.0  28.0
 4  2013     1     1      5 EWR    IAH   N14228  UA           4  39.9  28.0
 5  2013     1     1      5 EWR    IAH   N14228  UA           5  39.0  28.0
 6  2013     1     1      5 EWR    IAH   N14228  UA           6  37.9  28.0
 7  2013     1     1      5 EWR    IAH   N14228  UA           7  39.0  28.0
 8  2013     1     1      5 EWR    IAH   N14228  UA           8  39.9  28.0
 9  2013     1     1      5 EWR    IAH   N14228  UA           9  39.9  28.0
10  2013     1     1      5 EWR    IAH   N14228  UA          10  41    28.0
# … with 8,036,565 more rows, and 8 more variables: humid &lt;dbl&gt;,
#   wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
#   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 336,776 x 8
    year month   day  hour origin dest  tailnum carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
 1  2013     1     1     5 EWR    IAH   N14228  UA     
 2  2013     1     1     5 LGA    IAH   N24211  UA     
 3  2013     1     1     5 JFK    MIA   N619AA  AA     
 4  2013     1     1     5 JFK    BQN   N804JB  B6     
 5  2013     1     1     6 LGA    ATL   N668DN  DL     
 6  2013     1     1     5 EWR    ORD   N39463  UA     
 7  2013     1     1     6 EWR    FLL   N516JB  B6     
 8  2013     1     1     6 LGA    IAD   N829AS  EV     
 9  2013     1     1     6 JFK    MCO   N593JB  B6     
10  2013     1     1     6 LGA    ORD   N3ALAA  AA     
# … with 336,766 more rows
```
]

---
count: false
 

.panel1-lef-auto[

```r
library(nycflights13)

# mutating joins: left_join,right_join, full_join, inner_join
flights %&gt;%
  select(year:day, hour, origin, dest, tailnum, carrier) -&gt; flights2
flights2 %&gt;%
  left_join(airlines, by="carrier")

flights2 %&gt;%
  left_join(weather,
            by=c("origin","year","month","day"))
flights2 %&gt;%
* left_join(airports, c("dest"="faa"))
```
]
 
.panel2-lef-auto[

```
# A tibble: 336,776 x 9
    year month   day  hour origin dest  tailnum carrier name                    
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
 1  2013     1     1     5 EWR    IAH   N14228  UA      United Air Lines Inc.   
 2  2013     1     1     5 LGA    IAH   N24211  UA      United Air Lines Inc.   
 3  2013     1     1     5 JFK    MIA   N619AA  AA      American Airlines Inc.  
 4  2013     1     1     5 JFK    BQN   N804JB  B6      JetBlue Airways         
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Delta Air Lines Inc.    
 6  2013     1     1     5 EWR    ORD   N39463  UA      United Air Lines Inc.   
 7  2013     1     1     6 EWR    FLL   N516JB  B6      JetBlue Airways         
 8  2013     1     1     6 LGA    IAD   N829AS  EV      ExpressJet Airlines Inc.
 9  2013     1     1     6 JFK    MCO   N593JB  B6      JetBlue Airways         
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      American Airlines Inc.  
# … with 336,766 more rows
```

```
# A tibble: 8,036,575 x 19
    year month   day hour.x origin dest  tailnum carrier hour.y  temp  dewp
   &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2013     1     1      5 EWR    IAH   N14228  UA           1  39.0  26.1
 2  2013     1     1      5 EWR    IAH   N14228  UA           2  39.0  27.0
 3  2013     1     1      5 EWR    IAH   N14228  UA           3  39.0  28.0
 4  2013     1     1      5 EWR    IAH   N14228  UA           4  39.9  28.0
 5  2013     1     1      5 EWR    IAH   N14228  UA           5  39.0  28.0
 6  2013     1     1      5 EWR    IAH   N14228  UA           6  37.9  28.0
 7  2013     1     1      5 EWR    IAH   N14228  UA           7  39.0  28.0
 8  2013     1     1      5 EWR    IAH   N14228  UA           8  39.9  28.0
 9  2013     1     1      5 EWR    IAH   N14228  UA           9  39.9  28.0
10  2013     1     1      5 EWR    IAH   N14228  UA          10  41    28.0
# … with 8,036,565 more rows, and 8 more variables: humid &lt;dbl&gt;,
#   wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
#   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 336,776 x 15
    year month   day  hour origin dest  tailnum carrier name    lat   lon   alt
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2013     1     1     5 EWR    IAH   N14228  UA      Geor…  30.0 -95.3    97
 2  2013     1     1     5 LGA    IAH   N24211  UA      Geor…  30.0 -95.3    97
 3  2013     1     1     5 JFK    MIA   N619AA  AA      Miam…  25.8 -80.3     8
 4  2013     1     1     5 JFK    BQN   N804JB  B6      &lt;NA&gt;   NA    NA      NA
 5  2013     1     1     6 LGA    ATL   N668DN  DL      Hart…  33.6 -84.4  1026
 6  2013     1     1     5 EWR    ORD   N39463  UA      Chic…  42.0 -87.9   668
 7  2013     1     1     6 EWR    FLL   N516JB  B6      Fort…  26.1 -80.2     9
 8  2013     1     1     6 LGA    IAD   N829AS  EV      Wash…  38.9 -77.5   313
 9  2013     1     1     6 JFK    MCO   N593JB  B6      Orla…  28.4 -81.3    96
10  2013     1     1     6 LGA    ORD   N3ALAA  AA      Chic…  42.0 -87.9   668
# … with 336,766 more rows, and 3 more variables: tz &lt;dbl&gt;, dst &lt;chr&gt;,
#   tzone &lt;chr&gt;
```
]

&lt;style&gt;
.panel1-lef-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-lef-auto {
  color: black;
  width: 49%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-lef-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;







---
# anti &amp; semi
count: false
 

.panel1-lef2-auto[

```r
*flights
```
]
 
.panel2-lef2-auto[

```
# A tibble: 336,776 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
* count(dest, sort = TRUE)
```
]
 
.panel2-lef2-auto[

```
# A tibble: 105 x 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ORD   17283
 2 ATL   17215
 3 LAX   16174
 4 BOS   15508
 5 MCO   14082
 6 CLT   14064
 7 SFO   13331
 8 FLL   12055
 9 MIA   11728
10 DCA    9705
# … with 95 more rows
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
* head(10) -&gt; top_dest
```
]
 
.panel2-lef2-auto[

]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10) -&gt; top_dest

*flights %&gt;% semi_join(top_dest)
```
]
 
.panel2-lef2-auto[

```
# A tibble: 141,145 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      542            540         2      923            850
 2  2013     1     1      554            600        -6      812            837
 3  2013     1     1      554            558        -4      740            728
 4  2013     1     1      555            600        -5      913            854
 5  2013     1     1      557            600        -3      838            846
 6  2013     1     1      558            600        -2      753            745
 7  2013     1     1      558            600        -2      924            917
 8  2013     1     1      558            600        -2      923            937
 9  2013     1     1      559            559         0      702            706
10  2013     1     1      600            600         0      851            858
# … with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10) -&gt; top_dest

flights %&gt;% semi_join(top_dest)
*flights %&gt;% anti_join(top_dest)
```
]
 
.panel2-lef2-auto[

```
# A tibble: 141,145 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      542            540         2      923            850
 2  2013     1     1      554            600        -6      812            837
 3  2013     1     1      554            558        -4      740            728
 4  2013     1     1      555            600        -5      913            854
 5  2013     1     1      557            600        -3      838            846
 6  2013     1     1      558            600        -2      753            745
 7  2013     1     1      558            600        -2      924            917
 8  2013     1     1      558            600        -2      923            937
 9  2013     1     1      559            559         0      702            706
10  2013     1     1      600            600         0      851            858
# … with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 195,631 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      544            545        -1     1004           1022
 4  2013     1     1      557            600        -3      709            723
 5  2013     1     1      558            600        -2      849            851
 6  2013     1     1      558            600        -2      853            856
 7  2013     1     1      559            600        -1      941            910
 8  2013     1     1      559            600        -1      854            902
 9  2013     1     1      601            600         1      844            850
10  2013     1     1      602            610        -8      812            820
# … with 195,621 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10) -&gt; top_dest

flights %&gt;% semi_join(top_dest)
flights %&gt;% anti_join(top_dest)

*flights
```
]
 
.panel2-lef2-auto[

```
# A tibble: 141,145 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      542            540         2      923            850
 2  2013     1     1      554            600        -6      812            837
 3  2013     1     1      554            558        -4      740            728
 4  2013     1     1      555            600        -5      913            854
 5  2013     1     1      557            600        -3      838            846
 6  2013     1     1      558            600        -2      753            745
 7  2013     1     1      558            600        -2      924            917
 8  2013     1     1      558            600        -2      923            937
 9  2013     1     1      559            559         0      702            706
10  2013     1     1      600            600         0      851            858
# … with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 195,631 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      544            545        -1     1004           1022
 4  2013     1     1      557            600        -3      709            723
 5  2013     1     1      558            600        -2      849            851
 6  2013     1     1      558            600        -2      853            856
 7  2013     1     1      559            600        -1      941            910
 8  2013     1     1      559            600        -1      854            902
 9  2013     1     1      601            600         1      844            850
10  2013     1     1      602            610        -8      812            820
# … with 195,621 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 336,776 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      542            540         2      923            850
 4  2013     1     1      544            545        -1     1004           1022
 5  2013     1     1      554            600        -6      812            837
 6  2013     1     1      554            558        -4      740            728
 7  2013     1     1      555            600        -5      913            854
 8  2013     1     1      557            600        -3      709            723
 9  2013     1     1      557            600        -3      838            846
10  2013     1     1      558            600        -2      753            745
# … with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10) -&gt; top_dest

flights %&gt;% semi_join(top_dest)
flights %&gt;% anti_join(top_dest)

flights %&gt;%
* anti_join(planes, by = "tailnum")
```
]
 
.panel2-lef2-auto[

```
# A tibble: 141,145 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      542            540         2      923            850
 2  2013     1     1      554            600        -6      812            837
 3  2013     1     1      554            558        -4      740            728
 4  2013     1     1      555            600        -5      913            854
 5  2013     1     1      557            600        -3      838            846
 6  2013     1     1      558            600        -2      753            745
 7  2013     1     1      558            600        -2      924            917
 8  2013     1     1      558            600        -2      923            937
 9  2013     1     1      559            559         0      702            706
10  2013     1     1      600            600         0      851            858
# … with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 195,631 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      544            545        -1     1004           1022
 4  2013     1     1      557            600        -3      709            723
 5  2013     1     1      558            600        -2      849            851
 6  2013     1     1      558            600        -2      853            856
 7  2013     1     1      559            600        -1      941            910
 8  2013     1     1      559            600        -1      854            902
 9  2013     1     1      601            600         1      844            850
10  2013     1     1      602            610        -8      812            820
# … with 195,621 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 52,606 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      558            600        -2      753            745
 2  2013     1     1      559            600        -1      941            910
 3  2013     1     1      600            600         0      837            825
 4  2013     1     1      602            605        -3      821            805
 5  2013     1     1      608            600         8      807            735
 6  2013     1     1      611            600        11      945            931
 7  2013     1     1      623            610        13      920            915
 8  2013     1     1      624            630        -6      840            830
 9  2013     1     1      628            630        -2     1137           1140
10  2013     1     1      629            630        -1      824            810
# … with 52,596 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10) -&gt; top_dest

flights %&gt;% semi_join(top_dest)
flights %&gt;% anti_join(top_dest)

flights %&gt;%
  anti_join(planes, by = "tailnum") %&gt;%
* count(tailnum, sort = TRUE)
```
]
 
.panel2-lef2-auto[

```
# A tibble: 141,145 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      542            540         2      923            850
 2  2013     1     1      554            600        -6      812            837
 3  2013     1     1      554            558        -4      740            728
 4  2013     1     1      555            600        -5      913            854
 5  2013     1     1      557            600        -3      838            846
 6  2013     1     1      558            600        -2      753            745
 7  2013     1     1      558            600        -2      924            917
 8  2013     1     1      558            600        -2      923            937
 9  2013     1     1      559            559         0      702            706
10  2013     1     1      600            600         0      851            858
# … with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 195,631 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      544            545        -1     1004           1022
 4  2013     1     1      557            600        -3      709            723
 5  2013     1     1      558            600        -2      849            851
 6  2013     1     1      558            600        -2      853            856
 7  2013     1     1      559            600        -1      941            910
 8  2013     1     1      559            600        -1      854            902
 9  2013     1     1      601            600         1      844            850
10  2013     1     1      602            610        -8      812            820
# … with 195,621 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 722 x 2
   tailnum     n
   &lt;chr&gt;   &lt;int&gt;
 1 &lt;NA&gt;     2512
 2 N725MQ    575
 3 N722MQ    513
 4 N723MQ    507
 5 N713MQ    483
 6 N735MQ    396
 7 N0EGMQ    371
 8 N534MQ    364
 9 N542MQ    363
10 N531MQ    349
# … with 712 more rows
```
]

---
count: false
 

.panel1-lef2-auto[

```r
flights %&gt;%
  count(dest, sort = TRUE) %&gt;%
  head(10) -&gt; top_dest

flights %&gt;% semi_join(top_dest)
flights %&gt;% anti_join(top_dest)

flights %&gt;%
  anti_join(planes, by = "tailnum") %&gt;%
  count(tailnum, sort = TRUE)
```
]
 
.panel2-lef2-auto[

```
# A tibble: 141,145 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      542            540         2      923            850
 2  2013     1     1      554            600        -6      812            837
 3  2013     1     1      554            558        -4      740            728
 4  2013     1     1      555            600        -5      913            854
 5  2013     1     1      557            600        -3      838            846
 6  2013     1     1      558            600        -2      753            745
 7  2013     1     1      558            600        -2      924            917
 8  2013     1     1      558            600        -2      923            937
 9  2013     1     1      559            559         0      702            706
10  2013     1     1      600            600         0      851            858
# … with 141,135 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 195,631 x 19
    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
 1  2013     1     1      517            515         2      830            819
 2  2013     1     1      533            529         4      850            830
 3  2013     1     1      544            545        -1     1004           1022
 4  2013     1     1      557            600        -3      709            723
 5  2013     1     1      558            600        -2      849            851
 6  2013     1     1      558            600        -2      853            856
 7  2013     1     1      559            600        -1      941            910
 8  2013     1     1      559            600        -1      854            902
 9  2013     1     1      601            600         1      844            850
10  2013     1     1      602            610        -8      812            820
# … with 195,621 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

```
# A tibble: 722 x 2
   tailnum     n
   &lt;chr&gt;   &lt;int&gt;
 1 &lt;NA&gt;     2512
 2 N725MQ    575
 3 N722MQ    513
 4 N723MQ    507
 5 N713MQ    483
 6 N735MQ    396
 7 N0EGMQ    371
 8 N534MQ    364
 9 N542MQ    363
10 N531MQ    349
# … with 712 more rows
```
]

&lt;style&gt;
.panel1-lef2-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-lef2-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-lef2-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;








---

# long &amp; wide [tidyr](https://tidyr.tidyverse.org/articles/pivot.html)


- pivot_longer()

- pivot_wider()

---

count: false
 

.panel1-long_wide-auto[

```r
*gapminder
```
]
 
.panel2-long_wide-auto[

```
# A tibble: 1,704 x 6
   country     continent  year lifeExp      pop gdpPercap
   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8  8425333      779.
 2 Afghanistan Asia       1957    30.3  9240934      821.
 3 Afghanistan Asia       1962    32.0 10267083      853.
 4 Afghanistan Asia       1967    34.0 11537966      836.
 5 Afghanistan Asia       1972    36.1 13079460      740.
 6 Afghanistan Asia       1977    38.4 14880372      786.
 7 Afghanistan Asia       1982    39.9 12881816      978.
 8 Afghanistan Asia       1987    40.8 13867957      852.
 9 Afghanistan Asia       1992    41.7 16317921      649.
10 Afghanistan Asia       1997    41.8 22227415      635.
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
* select(country, continent, lifeExp, year)
```
]
 
.panel2-long_wide-auto[

```
# A tibble: 1,704 x 4
   country     continent lifeExp  year
   &lt;fct&gt;       &lt;fct&gt;       &lt;dbl&gt; &lt;int&gt;
 1 Afghanistan Asia         28.8  1952
 2 Afghanistan Asia         30.3  1957
 3 Afghanistan Asia         32.0  1962
 4 Afghanistan Asia         34.0  1967
 5 Afghanistan Asia         36.1  1972
 6 Afghanistan Asia         38.4  1977
 7 Afghanistan Asia         39.9  1982
 8 Afghanistan Asia         40.8  1987
 9 Afghanistan Asia         41.7  1992
10 Afghanistan Asia         41.8  1997
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
  select(country, continent, lifeExp, year) %&gt;%
* pivot_wider(names_from =year,
*             values_from = lifeExp)
```
]
 
.panel2-long_wide-auto[

```
# A tibble: 142 x 14
   country continent `1952` `1957` `1962` `1967` `1972` `1977` `1982` `1987`
   &lt;fct&gt;   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Afghan… Asia        28.8   30.3   32.0   34.0   36.1   38.4   39.9   40.8
 2 Albania Europe      55.2   59.3   64.8   66.2   67.7   68.9   70.4   72  
 3 Algeria Africa      43.1   45.7   48.3   51.4   54.5   58.0   61.4   65.8
 4 Angola  Africa      30.0   32.0   34     36.0   37.9   39.5   39.9   39.9
 5 Argent… Americas    62.5   64.4   65.1   65.6   67.1   68.5   69.9   70.8
 6 Austra… Oceania     69.1   70.3   70.9   71.1   71.9   73.5   74.7   76.3
 7 Austria Europe      66.8   67.5   69.5   70.1   70.6   72.2   73.2   74.9
 8 Bahrain Asia        50.9   53.8   56.9   59.9   63.3   65.6   69.1   70.8
 9 Bangla… Asia        37.5   39.3   41.2   43.5   45.3   46.9   50.0   52.8
10 Belgium Europe      68     69.2   70.2   70.9   71.4   72.8   73.9   75.4
# … with 132 more rows, and 4 more variables: `1992` &lt;dbl&gt;, `1997` &lt;dbl&gt;,
#   `2002` &lt;dbl&gt;, `2007` &lt;dbl&gt;
```
]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
  select(country, continent, lifeExp, year) %&gt;%
  pivot_wider(names_from =year,
              values_from = lifeExp) -&gt;
* gapminder_life_exp_wide
```
]
 
.panel2-long_wide-auto[

]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
  select(country, continent, lifeExp, year) %&gt;%
  pivot_wider(names_from =year,
              values_from = lifeExp) -&gt;
  gapminder_life_exp_wide
*gapminder_life_exp_wide
```
]
 
.panel2-long_wide-auto[

```
# A tibble: 142 x 14
   country continent `1952` `1957` `1962` `1967` `1972` `1977` `1982` `1987`
   &lt;fct&gt;   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Afghan… Asia        28.8   30.3   32.0   34.0   36.1   38.4   39.9   40.8
 2 Albania Europe      55.2   59.3   64.8   66.2   67.7   68.9   70.4   72  
 3 Algeria Africa      43.1   45.7   48.3   51.4   54.5   58.0   61.4   65.8
 4 Angola  Africa      30.0   32.0   34     36.0   37.9   39.5   39.9   39.9
 5 Argent… Americas    62.5   64.4   65.1   65.6   67.1   68.5   69.9   70.8
 6 Austra… Oceania     69.1   70.3   70.9   71.1   71.9   73.5   74.7   76.3
 7 Austria Europe      66.8   67.5   69.5   70.1   70.6   72.2   73.2   74.9
 8 Bahrain Asia        50.9   53.8   56.9   59.9   63.3   65.6   69.1   70.8
 9 Bangla… Asia        37.5   39.3   41.2   43.5   45.3   46.9   50.0   52.8
10 Belgium Europe      68     69.2   70.2   70.9   71.4   72.8   73.9   75.4
# … with 132 more rows, and 4 more variables: `1992` &lt;dbl&gt;, `1997` &lt;dbl&gt;,
#   `2002` &lt;dbl&gt;, `2007` &lt;dbl&gt;
```
]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
  select(country, continent, lifeExp, year) %&gt;%
  pivot_wider(names_from =year,
              values_from = lifeExp) -&gt;
  gapminder_life_exp_wide
gapminder_life_exp_wide %&gt;%
* pivot_longer(`1952`:`2007`,
*              names_to = "year",
*              values_to = "lifeExp")
```
]
 
.panel2-long_wide-auto[

```
# A tibble: 1,704 x 4
   country     continent year  lifeExp
   &lt;fct&gt;       &lt;fct&gt;     &lt;chr&gt;   &lt;dbl&gt;
 1 Afghanistan Asia      1952     28.8
 2 Afghanistan Asia      1957     30.3
 3 Afghanistan Asia      1962     32.0
 4 Afghanistan Asia      1967     34.0
 5 Afghanistan Asia      1972     36.1
 6 Afghanistan Asia      1977     38.4
 7 Afghanistan Asia      1982     39.9
 8 Afghanistan Asia      1987     40.8
 9 Afghanistan Asia      1992     41.7
10 Afghanistan Asia      1997     41.8
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
  select(country, continent, lifeExp, year) %&gt;%
  pivot_wider(names_from =year,
              values_from = lifeExp) -&gt;
  gapminder_life_exp_wide
gapminder_life_exp_wide %&gt;%
  pivot_longer(`1952`:`2007`,
               names_to = "year",
               values_to = "lifeExp") %&gt;%
* mutate(year=as.numeric(year))
```
]
 
.panel2-long_wide-auto[

```
# A tibble: 1,704 x 4
   country     continent  year lifeExp
   &lt;fct&gt;       &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 Afghanistan Asia       1952    28.8
 2 Afghanistan Asia       1957    30.3
 3 Afghanistan Asia       1962    32.0
 4 Afghanistan Asia       1967    34.0
 5 Afghanistan Asia       1972    36.1
 6 Afghanistan Asia       1977    38.4
 7 Afghanistan Asia       1982    39.9
 8 Afghanistan Asia       1987    40.8
 9 Afghanistan Asia       1992    41.7
10 Afghanistan Asia       1997    41.8
# … with 1,694 more rows
```
]

---
count: false
 

.panel1-long_wide-auto[

```r
gapminder %&gt;%
  select(country, continent, lifeExp, year) %&gt;%
  pivot_wider(names_from =year,
              values_from = lifeExp) -&gt;
  gapminder_life_exp_wide
gapminder_life_exp_wide %&gt;%
  pivot_longer(`1952`:`2007`,
               names_to = "year",
               values_to = "lifeExp") %&gt;%
  mutate(year=as.numeric(year)) -&gt;
* gapminder_life_exp_long
```
]
 
.panel2-long_wide-auto[

]

&lt;style&gt;
.panel1-long_wide-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-long_wide-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-long_wide-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;





---
# Practice

* 学生id, 学校id， 城市id，是否独生子女、是否近视、是否恋爱、期中考试语文原始成绩、是否实行百分制

* 只选择期中语文成绩实行100制的学生

* 将语文成绩的变量名称更改为chinese, 将是否独生子女变量名称更改为child_only, 是否恋爱变更为in_love.

---

# First Impression

- sjPlot:: view_df()

- dplyr:: glimpse()

- skimr::skim()

- janitor::clean_names() &amp; remove_empty()

---

# Missing value

- visdat::vis_miss()

- tidyr::drop_na()

- tidyr::replace_na()

- naniar::replace_with_na()

- base::is.na()

---
# Missing value [naniar](http://naniar.njtierney.com/)

Shorthand summaries for missing data:
- n_miss() and n_complete()

- pct_miss()and pct_complete()

Numerical summaries of missing data in variables and cases:
- miss_var_summary() and miss_var_table()

- miss_case_summary(), miss_case_table()


---
class: center, middle

# factor R4DS [15](https://r4ds.had.co.nz/factors.html)

---
class: center, middle
# date and time R4DS [16](https://r4ds.had.co.nz/dates-and-times.html)

---
class: inverse middle
# NEXT WEEK

- [gtsummary](http://www.danieldsjoberg.com/gtsummary/)

- [rstaix](https://rpkgs.datanovia.com/rstatix/)

- [flextable](https://davidgohel.github.io/flextable/index.html)

- [reactable](https://glin.github.io/reactable/)

- install_packages: skimr, janitor, visdat, naniar, rstatix, gtsummary, flextable, DT,


???

教学反思，学生普通对于R语言熟练程度和理解的程度还比较低，细小错误很多，影响了课程的进度，应当在课前明确课下预习的内容。并要求学习做必要练习,这样才能提高课程的进度与成效。

---
class: inverse, middle, center

# Thanks !
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
